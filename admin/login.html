<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Start Pray Admin | Secure Sign-In</title>
  <link rel="stylesheet" href="css/admin.css">
</head>
<body>
  <div class="login-wrapper">
    <div class="login-container">
      <aside class="login-hero">
        <span class="login-badge">Start Pray · Admin</span>
        <h2>守護社群祈禱的後台基地</h2>
        <p>使用多層安全驗證，確認身分後即可進入 Dashboard 管理用戶、禱告與代幣。</p>
        <ul class="hero-points">
          <li><strong>零時差指標</strong> 即時掌握平台動態與安全警示。</li>
          <li><strong>深入審核</strong> 快速處理回報、錄音與內容審核流程。</li>
          <li><strong>權限控管</strong> 精準指派角色、記錄操作軌跡。</li>
        </ul>
        <div class="hero-footnote">需要協助？請聯絡 security@prayercoin.app</div>
      </aside>

      <div class="login-card">
        <div class="login-header">
          <span class="login-tag">Admin Access</span>
          <h1>登入後台管理中心</h1>
          <p>輸入管理員帳號與密碼，再完成六位數 2FA 驗證碼即可登入。</p>
        </div>

        <form id="admin-login-form" autocomplete="off">
          <div class="input-group">
            <label for="admin-email">管理員電子郵件</label>
            <input type="email" id="admin-email" name="email" value="admin@prayercoin.app" placeholder="name@prayercoin.app" autocomplete="username" required>
          </div>

          <div class="input-group">
            <div class="field-header">
              <label for="admin-password">密碼</label>
              <a class="field-meta" href="#">重新發送密碼</a>
            </div>
            <input type="password" id="admin-password" name="password" placeholder="輸入管理員密碼" autocomplete="current-password" required>
          </div>

          <div class="input-group">
            <div class="field-header">
              <label for="mfa-code-1">二階段驗證 (2FA)</label>
              <span class="field-meta">啟用時間：2025-09-20</span>
            </div>
            <p class="field-hint">請輸入六位數字驗證碼。本階段測試碼為 <code>123456</code>。</p>
            <div class="code-grid" role="group" aria-label="六位數字驗證碼輸入">
              <input class="code-input" id="mfa-code-1" type="text" inputmode="numeric" pattern="[0-9]*" autocomplete="one-time-code" maxlength="1" aria-label="驗證碼第 1 位" required>
              <input class="code-input" id="mfa-code-2" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="驗證碼第 2 位" required>
              <input class="code-input" id="mfa-code-3" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="驗證碼第 3 位" required>
              <input class="code-input" id="mfa-code-4" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="驗證碼第 4 位" required>
              <input class="code-input" id="mfa-code-5" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="驗證碼第 5 位" required>
              <input class="code-input" id="mfa-code-6" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="驗證碼第 6 位" required>
            </div>
          </div>

          <div class="form-status" id="form-status" role="status" aria-live="polite"></div>

          <button type="submit" class="primary-button">登入管理介面</button>
        </form>

        <ul class="security-list">
          <li>登入流程採用 OAuth 2.1 + PKCE，並結合 WebAuthn / TOTP。</li>
          <li>連線將驗證來源 IP 與裝置指紋，五次失敗將鎖定帳號。</li>
          <li>若在公共裝置上操作，建議完成後立即登出並清除紀錄。</li>
        </ul>

        <div class="control-row">
          <a href="../index.html">返回主站</a>
          <a href="#">忘記密碼</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const form = document.getElementById('admin-login-form');
      if (!form) return;
      const codeInputs = Array.from(form.querySelectorAll('.code-input'));
      const statusEl = document.getElementById('form-status');
      const submitBtn = form.querySelector('button[type="submit"]');
      const expectedCode = '123456';

      const setStatus = (message, type) => {
        if (!statusEl) return;
        statusEl.textContent = message || '';
        statusEl.classList.remove('is-error', 'is-success');
        if (type === 'error') statusEl.classList.add('is-error');
        if (type === 'success') statusEl.classList.add('is-success');
      };

      const focusNext = (index) => {
        const next = codeInputs[index + 1];
        if (next) next.focus();
      };

      const focusPrev = (index) => {
        const prev = codeInputs[index - 1];
        if (prev) prev.focus();
      };

      codeInputs.forEach((input, index) => {
        input.addEventListener('input', (event) => {
          const digits = event.target.value.replace(/\D/g, '');
          event.target.value = digits.slice(-1);
          if (event.target.value && index < codeInputs.length - 1) {
            focusNext(index);
          }
        });

        input.addEventListener('keydown', (event) => {
          if (event.key === 'Backspace' && !event.target.value && index > 0) {
            focusPrev(index);
          }
          if (event.key === 'ArrowLeft') {
            event.preventDefault();
            focusPrev(index);
          }
          if (event.key === 'ArrowRight') {
            event.preventDefault();
            focusNext(index);
          }
        });

        input.addEventListener('paste', (event) => {
          const clipboard = (event.clipboardData || window.clipboardData);
          if (!clipboard) return;
          const digits = clipboard.getData('text').replace(/\D/g, '').slice(0, codeInputs.length).split('');
          if (!digits.length) return;
          codeInputs.forEach((box, idx) => {
            box.value = digits[idx] || '';
          });
          const lastIndex = Math.min(digits.length, codeInputs.length) - 1;
          if (lastIndex >= 0 && lastIndex < codeInputs.length - 1) {
            codeInputs[lastIndex + 1].focus();
          }
          event.preventDefault();
        });
      });

      form.addEventListener('submit', (event) => {
        event.preventDefault();
        const code = codeInputs.map((input) => input.value).join('');

        if (code.length < codeInputs.length) {
          setStatus('請輸入 6 位數字驗證碼。', 'error');
          return;
        }

        if (code !== expectedCode) {
          setStatus('驗證碼錯誤，請再次確認。', 'error');
          codeInputs.forEach((input) => {
            input.classList.add('has-error');
          });
          setTimeout(() => {
            codeInputs.forEach((input) => input.classList.remove('has-error'));
          }, 600);
          return;
        }

        setStatus('驗證成功，正在導向 Dashboard…', 'success');
        submitBtn.disabled = true;
        submitBtn.classList.add('loading');
        setTimeout(() => {
          window.location.href = 'dashboard.html';
        }, 900);
      });
    })();
  </script>
</body>
</html>
